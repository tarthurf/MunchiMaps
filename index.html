<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MunchiMaps</title>
    <link rel="stylesheet" href="assets/styles/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa|Fredoka+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles/style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src=script.js></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>

<body>
    <section class="hero is-small is-primary is-bold fredoka">
        <div class="hero-body">
                <div class="container">
                    <h1 class="title is-1">
                        MunchiMaps
                    </h1>
                    <p class="subtitle">
                        Connecting CBD to Delicious food
                    </p>
                </div>
            </div>
        </section>
        
        <section class="box is-marginless comfortaa">
            <div class="field has-addons ">
                <div class="control has-icons-left">
                    <input class="input is-fluid" type="text" placeholder="City or Zip">
                    <span class="icon is-small is-left">
                        <img src="assets/images/GPS-PNG-HD.png"></img>
                    </span>
                </div>
                <div class="control">
                    <a class="button is-primary">
                        Search
                    </a>
                </div>
            </div>
            <p class="help text-is-centered">Leave Empty For Current Location</p>
        </section>
        
        
        <section class="section card-section">
            <div class="container">
            </div>
        </section>
        
        <footer class="footer">
            <div class="content has-text-centered">
                <p>
                    <strong>Bulma</strong> by <a href="https://jgthms.com">Jeremy Thomas</a>. The source code is licensed
                    <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content
                    is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.
                </p>
            </div>
        </footer>
        
    </body>
    <!-- This script id for the Yelp API call-->
    <script>
        var dispArray = [];
        var restArray = [];

function getDispensary(userLoc){
    var location = userLoc;
    var settings = {
        "url": "http://cors-anywhere.herokuapp.com/https://api.yelp.com/v3/businesses/search?&term=weed&location=" + location,
        "method": "GET",
        "timeout": 0,
        "headers": {
            "accept": "application/json",
            "x-requested-with": "xmlhttprequest",
            "Access-Control-Allow-Origin":"*",
            "Authorization": "Bearer f8a8rHUaTF8-rGjw6Ap5l3RLMBlUolqUUy7wKupzJ1MDPlSWDctHN4Qh197KOHHmaUEHXNA_5wljb3aJAramwCFqZPoaq7gPHRpCE9a7FLrWpwY9eaw3Mr4vw-g1XnYx"
        },
    };
      
    $.ajax(settings).done(function (response) {
            for (let index = 0; index < 5; index++){
                dispArray[index] = response.businesses[index];
            }
        localStorage.setItem("dispArray", JSON.stringify(dispArray));
        var item = JSON.parse(localStorage.getItem("dispArray"));
        console.log(item);
        for (index = 0; index < item.length; index++){
            makeCards(item[index], index);
        }
    });

}

function getRestaurants (dispLoc){
    var location = dispLoc;
    var settings = {
        "url": "http://cors-anywhere.herokuapp.com/https://api.yelp.com/v3/businesses/search?&term=restaurants&location=" + location,
        "method": "GET",
        "timeout": 0,
        "headers": {
            "accept": "application/json",
            "x-requested-with": "xmlhttprequest",
            "Access-Control-Allow-Origin":"*",
            "Authorization": "Bearer f8a8rHUaTF8-rGjw6Ap5l3RLMBlUolqUUy7wKupzJ1MDPlSWDctHN4Qh197KOHHmaUEHXNA_5wljb3aJAramwCFqZPoaq7gPHRpCE9a7FLrWpwY9eaw3Mr4vw-g1XnYx"
        },
      };
      
      $.ajax(settings).done(function (response) {
        for (let index = 0; index < 5; index++){
          restArray[index]=response.businesses[index];
        }
        localStorage.setItem("restArray", JSON.stringify(dispArray));
      });
}
function makeCards(obj,index){
    var card = $("<div>", {
        "class": "card-content",
        "value": index});
    var media = $("<div>", {"class": "media"});
    var col = $("<div>", {"class": "column"});
    var imgHolder = $("<div>", {"class": "card-image"});
    var fig = $("<figure>", {"class": "image is-2by1"});
    var img = $("<img>", {
        "class": "business-image",
        "src": obj.image_url,
        "alt": "Placeholder Image"});
    var content = $("<div>", {"class": "content comforataa"});
    var busName = $("<div>", {
        "id": "businessName",
        "text": obj.name});
    var busAddy = $("<div>", {
        "id": "address",
        "text": obj.location.address1});
    var busNum = $("<div>", {
        "id": "phoneNumber",
        "text": obj.phone});
    var indivCard = $("<div>", {
        "class": "card"});
        // "style": "margin-bottom: 12px"
    content.append(busName, busAddy, busNum);   
    
    fig.append(img);
    imgHolder.append(fig);
   
                 
            
    media.append(content);
    card.append(media);
    col.append(card);
    indivCard.append(imgHolder);
    indivCard.append(col);

    $(".card-section").find(".container").append(indivCard);
                    
                   
}

$(".is-primary").on("click", function(){
    $(".card").empty();
    getDispensary($(".input").val());
 });
    
 $(document).on("click", ".card", function(){
    console.log($(this).find(".card-content").attr("value"));
 });


  
   
  
    //Need Ajax request to return list of 5 weed dispensaries nearby
    //store the 5 dispensaries as objects in an array 
    //Object needs to Business name, location, photo, rating, price, small description
    //Once a business is picked, use that location to bring up 5 restaurants by that location 
    //Object needs to Business name, location, photo, rating, price, small description

    </script>
    <!-- This script is for the Yelp API call -->


<script>

</script>

    <!-- linking scripts -->
   

</html>